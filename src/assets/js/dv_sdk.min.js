 (function(l){function h(a,b,c,d,e){e=e||!1;var f=new XMLHttpRequest;f.addEventListener("readystatechange",function(){var a="";4===this.readyState&&0==e?200==this.status?(a=JSON.parse(this.responseText),d(a)):(d(a),console.error("Devless cannot be found at "+this.devless_instance_url+" Please copy the url from the `App tab`  on you Devless instance by clicking on  `connect to my app`")):4===this.readyState&&1==e&&(200==this.status?(a=this.responseText,d(a)):(d(a),console.error("Devless cannot be found at "+
this.devless_instance_url+" Please copy the url from the `App tab`  on you Devless instance by clicking on  `connect to my app`")))});f.open(c.toUpperCase(),this.devless_instance_url+b);f.setRequestHeader("content-type","application/json");f.setRequestHeader("devless-token",this.devless_token);""!=localStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token)&&f.setRequestHeader("devless-user-token",localStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token));
f.send(a)}var k=function(a){if(a){console.info("App is trying to connect to Devless ...");var b=new k.init(a);l.returnedInstance="";h.call(b,{},"/api/v1/service//dvauth/script","POST",function(a){a=JSON.parse(a);631==a.status_code?console.error("Your app failed to  connect to Devless ): Please make sure token and key is set properly "):(1E3==a.status_code?console.debug("Your app connected to Devless successfully and you have auth service installed"):console.info("Your app connected to Devless successfully"),
returnedInstance=b)},!0);return b}console.error("Your app failed to  connect to Devless ): Please make sure token and key is set properly ")};k.prototype={queryData:function(a,b,c,d){c=c||{};var e="",f=function(a,b){for(var c in b)e="&"+a+"="+b[c]+e},g;for(g in c)c.hasOwnProperty(g),c[g]instanceof Array?f(g,c[g]):e="&"+g+"="+c[g]+e;h.call(this,"","/api/v1/service/"+a+"/db?table="+b+e,"GET",function(a){d(a)});return this},addData:function(a,b,c,d){b=JSON.stringify({resource:[{name:b,field:[c]}]});
h.call(this,b,"/api/v1/service/"+a+"/db","POST",function(a){d(a)});return this},updateData:function(a,b,c,d,e,f){b=JSON.stringify({resource:[{name:b,params:[{where:c+","+d,data:[e]}]}]});h.call(this,b,"/api/v1/service/"+a+"/db","PATCH",function(a){f(a)});return this},deleteData:function(a,b,c,d,e){b={resource:[{name:b,params:[{where:c+",=,"+d}]}]};b.resource[0].params[0]["delete"]="true";b=JSON.stringify(b);h.call(this,b,"/api/v1/service/"+a+"/db","DELETE",function(a){e(a)});return this},getToken:function(a){if(a)a(localStorage.getItem("devless_user_token"+
this.devless_instance_url+this.devless_token));else return localStorage.getItem("devless_user_token"+this.devless_instance_url+this.devless_token)},setToken:function(a){localStorage.setItem("devless_user_token"+this.devless_instance_url+this.devless_token,a);return!0},call:function(a,b,c,d){c=JSON.stringify({jsonrpc:"2.0",method:a,id:Math.floor(1E7*Math.random())+1,params:c});h.call(this,c,"/api/v1/service/"+a+"/rpc?action="+b,"POST",function(a){d(a)})},publicWS:function(a){(new EventSource("https://7058c724.fanoutcdn.com/test/sse")).addEventListener("message",
function(b){a(JSON.parse(b.data.slice(0,-1)))},!1)},signUp:function(a,b){var c=this;this.call("devless","signUp",[a.email,a.password,a.username,a.phone,a.firstname,a.lastname,null],function(a){c.setToken(a.payload.result.token);console.log("response on siging up => ",a.payload.result);b(a.payload.result)})},signIn:function(a,b){var c=this;this.call("devless","login",[a.username,a.email,a.phone,a.password],function(a){c.setToken(a.payload.result.token);b(a.payload.result)})},updateProfile:function(a,
b){this.call("devless","updateProfile",[a.email,a.password,a.username,a.phone,a.firstname,a.lastname,"anything else"],function(a){b(a.payload.result)})},getProfile:function(a){this.call("devless","profile",[],function(b){a(b)})},logout:function(a){this.call("devless","logout",[],function(b){a(b)})}};k.init=function(a){this.devless_token=a.token;this.devless_instance_url=a.domain};k.init.prototype=k.prototype;l.Devless=l.DV=k})(window);
